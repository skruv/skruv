var j=Symbol.for("skruvDom"),x=Symbol.for("skruvDomPrepared"),S=new WeakMap,O=new WeakMap,P=new WeakMap,v=()=>{},U=new Promise(t=>{v=()=>t()}),g=new Set,_=(globalThis==null?void 0:globalThis.SkruvWaitForAsync)||!!document.querySelector("data-skruv-ssr-rendered");var G=(t,...e)=>{var r,l,i,o,f;return{s:j,t,...typeof e[0]=="object"&&!Array.isArray(e[0])&&!(e[0]instanceof Function)&&!(e[0]instanceof Function&&((i=(l=(r=e[0])==null?void 0:r.prototype)==null?void 0:l.toString)==null?void 0:i.call(l))==="[object AsyncGenerator]")&&!((o=e[0])!=null&&o[Symbol.asyncIterator])&&((f=e[0])==null?void 0:f.s)!==j?{_a:e[0],_c:e.slice(1)}:{_a:{},_c:e},r:{r:()=>(_&&!g.size&&(_=!1,v()),!0)}}},M=(t,e,r)=>{var i,o;let l=(f,a)=>{var m;return _&&((m=a==null?void 0:a._a)==null?void 0:m["data-skruv-finished"])!==!1&&(g.delete(f),a&&((a==null?void 0:a.s)===j?E(a):M(a,e,r))),S.set(f,a),e.r.r()};if(S.has(t))return S.get(t);if(typeof t=="object"&&(t==null?void 0:t[Symbol.asyncIterator])){let f=t;return _&&g.add(f),S.set(f,null),(async()=>{for await(let a of f)if(!l(t,a))break})(),!1}else{if(t instanceof Function&&((o=(i=t==null?void 0:t.prototype)==null?void 0:i.toString)==null?void 0:o.call(i))==="[object AsyncGenerator]")return _&&g.add(t),S.set(t,null),(async()=>{for await(let f of t())if(!l(t,f))break})(),!1;if(typeof t=="object"&&t!==null&&(t==null?void 0:t.then)instanceof Function){let f=t;return _&&g.add(t),S.set(f,null),(async()=>l(f,await f))(),!1}else{if(typeof t=="function"&&t.constructor.name==="AsyncFunction")return _&&g.add(t),S.set(t,null),(async()=>l(t,await t()))(),!1;if(typeof t=="function")return r?t():t;if(typeof t=="string"||typeof t=="number")return r?G("#text",{data:t.toString()}):t.toString();if(typeof t=="boolean")return t}}throw new Error("Unkown type in syncify: "+JSON.stringify(t))},H=(t,e)=>{let r=t.flat(1/0).map(l=>(l==null?void 0:l.s)===j?E(l):M(l,e,!0)).flat(1/0).filter(l=>l!==null&&typeof l!="boolean"&&typeof l!="undefined");return r.find(l=>(l==null?void 0:l.p)!==x)!==void 0?H(r,e):r},E=t=>{let e=Object.fromEntries(Object.entries(t._a).filter(r=>r[1]!==null&&typeof r[1]!="undefined").map(([r,l])=>r==="data-skruv-key"?[r,l]:[r,M(l,t,!1)]).filter(r=>r[1]!==null&&typeof r[1]!="undefined"));return{p:x,...t,a:e,c:H(t._c,t)}},C=(t,e,r,l)=>{var w;if(t.p!==x)throw new Error("unkown type in render: "+JSON.stringify(t));for(let n of t.c)if(n.p!==x)throw new Error("unkown type in render: "+JSON.stringify(n));if(!r||e&&!r.contains(e))return!1;let i=e.ownerDocument,o=i.documentElement;for(let n of e.getAttributeNames().filter(c=>!Object.keys(t.a).includes(c)))e.removeAttribute(n);for(let[n,c]of Object.entries(t.a))if(n!=="data-skruv-key"){if(n.slice(0,2)==="on"){let y=O.get(e),s=y==null?void 0:y[n],d=n.slice(2);if(y||(y={},O.set(e,y)),c instanceof Function){s&&s.toString()!==c.toString()&&(e.removeEventListener(d,s),y[n]=null),s||(y[n]=c,e.addEventListener(d,c));continue}s&&!c&&(e.removeEventListener(d,s),y[n]=null)}if(c===null||c===!1){e.getAttribute(n)&&e.removeAttribute(n);continue}e.setAttribute(n,c.toString()),n==="value"&&(typeof c=="number"||typeof c=="string")&&e instanceof HTMLInputElement&&(e[n]=c.toString()),(typeof c=="boolean"&&(e instanceof HTMLInputElement&&n==="checked"||e instanceof HTMLOptionElement&&n==="selected")||typeof c=="object")&&(e[n]=c)}if(t.r.r=()=>C(E(t),e,r,l),t.a["data-skruv-opaque"])return!0;let f=Array.from(e.childNodes),a=t.c,m=[],p=(n,c)=>n.nodeName.toLowerCase()===c.t&&!m.includes(n);for(let n=0;n<a.length;n++){let c=a[n],y=c.a["data-skruv-key"]?P.get(c.a["data-skruv-key"]):f.find(s=>p(s,c));y?m[n]=y:m[n]=null}let u=f.filter(n=>!m.includes(n));if(t.c.length||!t.a["data-skruv-wait-for-not-empty"])for(let n of u.filter(c=>!!c))e.removeChild(n),setTimeout(()=>{var c;!(o!=null&&o.contains(n))&&((c=O.get(n))==null?void 0:c.onremove)&&n.dispatchEvent(new CustomEvent("remove"))},1);for(let n=0;n<m.length;n++){let c=t.c[n],y=!1;if(m[n]){if(m[n]!==e.childNodes[n]){let d=m[n];d&&(n===0?e.prepend(d):e.childNodes[n-1].after(d))}}else{let d;t.t==="#comment"?d=i.createComment(""):c.t==="#text"?d=i.createTextNode(""):c.p===x&&(l||c.t==="svg")?d=i.createElementNS("http://www.w3.org/2000/svg",c.t):d=i.createElement(c.t),y=!0,e.childNodes[n]?e.replaceChild(d,e.childNodes[n]):n===0?e.prepend(d):e.childNodes[n-1].after(d)}let s=e.childNodes[n];if(s instanceof Text||s instanceof Comment){s.data!==c.a.data&&(s.data=c.a.data.toString());continue}if(!(s instanceof HTMLElement||s instanceof SVGElement))throw new Error("Child node of unknown type: "+JSON.stringify({childNode:s,child:c}));c.a["data-skruv-key"]&&!P.has(c.a["data-skruv-key"])&&P.set(c.a["data-skruv-key"],s),C(c,s,e,l||t.t==="svg"),y&&((w=O.get(s))==null?void 0:w.oncreate)&&s.dispatchEvent(new CustomEvent("create"))}return!0},I=async(t,e=document.documentElement,r=e==null?void 0:e.parentNode,l=!1)=>{if(!r)throw new Error("Skruv: No parent to render to");if(!(r instanceof HTMLElement||r instanceof SVGElement||r instanceof Document||r instanceof Window))throw new Error("Skruv: Parent of wrong type");_&&(E(t).r.r(),await U),C(E(t),e,r,l)},B={},W=new Proxy(B,{get:(t,e)=>(...r)=>G(e,...r)});var R=()=>{},D=new Promise(t=>{R=t}),T=new Map,z=t=>{let e=0;if(t.length===0)return e.toString();for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e.toString()},J=(t,...e)=>{var y;let r=t.reduce((s,d,h)=>{var b;return s.push(d),s.push(((b=e==null?void 0:e[h])==null?void 0:b.toString())||""),s},[]).join(""),l=/^\[.*?(?:(["'])(?:.|\\\1)*\1.*)*\]/,i=/([([,]|:scope\b)/,o=/^:scope\b/;function f(s,d){let h=s.search(i);if(h===-1)return{selector:`${d} ${s}`,rest:""};if(s[h]===",")return{selector:`${d} ${s.substring(0,h)}`,rest:s.substring(h+1)};let b=!0,$=!1;h=s.search(/\S/);let k=0;t:for(;h<s.length;++h){let F=s[h];switch(F){case"[":{let L=l.exec(s.substring(h));h+=(L?L[0].length:1)-1;continue}case"(":++k;continue;case":":if(b)if(o.test(s.substring(h))){if(k)return null}else continue;else continue;s=s.substring(0,h)+d+s.substring(h+6),h+=d.length,$=!0,--h;continue;case")":k&&--k;continue}if(!k)switch(F){case",":break t;case" ":case">":case"~":case"+":if(!b)continue;b=!1}}return{selector:($?"":`${d} `)+s.substring(0,h),rest:s.substring(h+1)}}function a(s,d){let h=[];for(;s;){let b=f(s,d);if(b===null)return":not(*)";h.push(b.selector),s=b.rest}return h.join(", ")}function m(s,d){if(s instanceof CSSMediaRule){let h=s.cssRules.length;for(let b=0;b<h;++b)m(s.cssRules[b],d);return}s instanceof CSSStyleRule&&(s.selectorText=a(s.selectorText,d))}let p=z(r),u=`skruv-css-scope-${p}`,w=`.${u}`;if(T.has(p))return u;let n;if(!(globalThis!=null&&globalThis.CSSOM)&&!((y=globalThis.document)!=null&&y.implementation))throw new Error("No css parser available. Either add CSSOM to globalThis or run in browser.");if(globalThis!=null&&globalThis.CSSOM)n=CSSOM.parse(r);else{let s=globalThis.document.implementation.createHTMLDocument(""),d=s.createElement("style");d.innerText=r,s.body.append(d),n=d.sheet,s.body.removeChild(d)}Array.from((n==null?void 0:n.cssRules)||[]).forEach(s=>m(s,w));let c=Array.from((n==null?void 0:n.cssRules)||[]).map(s=>s.cssText||"").join("");return T.set(p,c),R(),u};async function*V(){for(yield Array.from(T.values()).join("");;)await D,yield Array.from(T.values()).join(""),D=new Promise(t=>{R=t})}var K=(globalThis==null?void 0:globalThis.requestAnimationFrame)||(t=>setTimeout(t,0)),q=t=>{let e=class{constructor(i){this.name=i,this._scheduled=!1,this._skruv_promise=new Promise(o=>{this._skruv_resolve=o})}_resolve(){this._skruv_parent&&this._skruv_parent._resolve&&this._skruv_parent._resolve(),!this._scheduled&&(this._scheduled=!0,K(()=>{this._skruv_resolve(),this._skruv_promise=new Promise(i=>{this._skruv_resolve=i}),this._scheduled=!1}))}set(i,o,f){return o==="_skruv_parent"?(this._skruv_parent=f,!0):(i[o]!==f&&(i[o]=this.recurse(o,f,i)),!0)}get(i,o,f){return o==="getGenerator"?a=>({key:[a,i],[Symbol.asyncIterator]:()=>{let m=!1;return{next:async()=>(m?await this._skruv_promise:m=!0,{done:!1,value:f[a]})}}}):o==="skruv_resolve"?()=>this._resolve():o==="skruv_unwrap_proxy"||o==="toJSON"?i.constructor===Object?Object.getOwnPropertyNames(i).reduce((a,m)=>{var p;return a[m]=((p=i[m])==null?void 0:p.skruv_unwrap_proxy)||i[m],a},{}):i.constructor===Array?i.map(a=>(a==null?void 0:a.skruv_unwrap_proxy)||a):i:o===Symbol.asyncIterator?()=>{let a=!1;return{next:async()=>(a?await this._skruv_promise:a=!0,{done:!1,value:f})}}:i[o]}deleteProperty(i,o){let f=delete i[o];return this._resolve(),f}recurse(i,o,f){var a;if(o&&o.constructor)if(o.constructor===Object&&((a=f==null?void 0:f[i])==null?void 0:a.constructor)===Object){for(let m of Object.getOwnPropertyNames(o))f[i][m]!==o[m]&&(f[i][m]=o[m]);for(let m of Object.getOwnPropertyNames(f[i]).filter(p=>!Object.getOwnPropertyNames(o).includes(p)))delete f[i][m],this._resolve();return f[i]}else if(o.constructor===Object){let m=new this.constructor(`${this.name}.${i}`);o=Object.keys(o).reduce((p,u)=>(p[u]=this.recurse(`${i}.${u}`,o[u]),typeof p[u]=="object"&&p[u]!==null&&(p[u]._skruv_parent=m),p),{}),o=new Proxy(o,m),o._skruv_parent=this,this._resolve()}else if(o.constructor===Array){let m=new this.constructor(`${this.name}.${i}`);o=o.map((p,u)=>{let w=this.recurse(`${i}[${u}]`,p);return typeof w=="object"&&w!==null&&(w._skruv_parent=m),w}),o=new Proxy(o,m),o._skruv_parent=this,this._resolve()}else this._resolve();else this._resolve();return o}},r=new Proxy(t.constructor===Array?[]:{},new e("root"));return Object.assign(r,t),r};var{html:Q,head:X,title:Y,script:Z,meta:N,body:tt,main:et,h1:nt,form:st,input:ot,button:rt,ol:it,li:ct,a:ft,style:lt}=W,A=q({todos:["Write todos"]}),at=J`:root{font-family:-apple-system,BlinkMacSystemFont,avenir next,avenir,segoe ui,helvetica neue,helvetica,Cantarell,Ubuntu,roboto,noto,arial,sans-serif}body{max-width:40ch;margin:0 auto}form{display:flex}input{flex:1}`,mt=()=>I(Q({lang:"en-US",class:at},X(Y(A.todos.getGenerator(0)),N({name:"viewport",content:"width=device-width, initial-scale=1"}),lt(V)),tt(et(nt(A.todos.getGenerator(0)),st({onsubmit:t=>{t.preventDefault(),A.todos.unshift(new FormData(t.target).get("todo")),t.target.reset()}},ot({type:"text",name:"todo"}),rt("New!")),async function*(){for await(let t of A)yield it(t.todos.map((e,r)=>ct(`${e} `,ft({href:"#",onclick:l=>{l.preventDefault(),t.todos.splice(r,1)}},"x"))))}),!!globalThis.skruvSSRScript&&Z({type:"module"},globalThis.skruvSSRScript))));mt();export{mt as doRender};
//# sourceMappingURL=index.min.js.map
