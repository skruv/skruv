<!DOCTYPE html>
<title>Skruv counter example</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="module">
  import { createState, elements, render } from '../skruv.js'
  const {
    html,
    head,
    title,
    meta,
    body,
    main,
    h1,
    input,
    ul,
    li,
    button
  } = elements

  export const state = createState({
    todos: [],
    value: ""
  })


  const shuffle = (a) => {
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  setInterval(() => {state.todos = shuffle(state.todos)}, 3000)

  render(
    html({ lang: 'en-US' },
      head({},
        title({}, state.todos.getGenerator(0)),
        meta({ name: 'viewport', content: 'width=device-width, initial-scale=1' }),
        meta({ name: 'description', content: state.todos.getGenerator(0) })
      ),
      body({},
        main({},
          h1({}, 'To do list'),
          async function* () {
            for await (const currentState of state) {
              yield [
                input({ type: "text", value: currentState.value, oninput: e => currentState.value = e.target.value }),
                ul({},
                  currentState.todos.map((todo) => li({}, todo))
                ),
                button({ onclick: () => { currentState.todos.push(currentState.value) } }, 'New!')
              ]
            }
          }
        )
      )
    )
  )
</script>