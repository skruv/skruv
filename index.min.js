var k=Symbol.for("skruvDom"),g=Symbol.for("skruvDomPrepared"),w=new WeakMap,E=new WeakMap,S=new WeakMap,L=()=>{},M=new Promise(t=>{L=()=>t()}),h=new Set,m=(globalThis==null?void 0:globalThis.SkruvWaitForAsync)||!!document.querySelector("data-skruv-ssr-rendered"),I={s:k,t:"",_c:[],_a:{},r:{r:()=>!1}},P={},O=(t,...n)=>{var i,s,d,l,r;return{s:k,t,...typeof n[0]=="object"&&!Array.isArray(n[0])&&!(n[0]instanceof Function)&&!(n[0]instanceof Function&&((d=(s=(i=n[0])==null?void 0:i.prototype)==null?void 0:s.toString)==null?void 0:d.call(s))==="[object AsyncGenerator]")&&!((l=n[0])!=null&&l[Symbol.asyncIterator])&&((r=n[0])==null?void 0:r.s)!==k?{_a:n[0],_c:n.slice(1)}:{_a:{},_c:n},r:{r:()=>(m&&!h.size&&(m=!1,L()),!0)}}},x=(t,n,i)=>{var d,l;let s=(r,a)=>{var p;return m&&((p=a==null?void 0:a._a)==null?void 0:p["data-skruv-finished"])!==!1&&(h.delete(r),a&&((a==null?void 0:a.s)===k?b(a):x(a,n,i))),w.set(r,a),n.r.r()};if(w.has(t))return w.get(t);if(typeof t=="object"&&(t==null?void 0:t[Symbol.asyncIterator])){let r=t;return m&&h.add(r),w.set(r,null),(async()=>{for await(let a of r)if(!s(t,a))break})(),!1}else{if(t instanceof Function&&((l=(d=t==null?void 0:t.prototype)==null?void 0:d.toString)==null?void 0:l.call(d))==="[object AsyncGenerator]")return m&&h.add(t),w.set(t,null),(async()=>{for await(let r of t())if(!s(t,r))break})(),!1;if(typeof t=="object"&&t!==null&&(t==null?void 0:t.then)instanceof Function){let r=t;return m&&h.add(t),w.set(r,null),(async()=>s(r,await r))(),!1}else{if(typeof t=="function"&&t.constructor.name==="AsyncFunction")return m&&h.add(t),w.set(t,null),(async()=>s(t,await t()))(),!1;if(typeof t=="function")return i?t():t;if(typeof t=="string"||typeof t=="number")return i?O("#text",{data:t.toString()}):t.toString();if(typeof t=="boolean")return t}}throw new Error("Unkown type in syncify: "+JSON.stringify(t))},T=(t,n)=>{let i=t.flat(1/0).map(s=>(s==null?void 0:s.s)===k?b(s):x(s,n,!0)).flat(1/0).filter(s=>s!==null&&typeof s!="boolean"&&typeof s!="undefined");return i.find(s=>(s==null?void 0:s.p)!==g)!==void 0?T(i,n):i},b=t=>{let n=Object.fromEntries(Object.entries(t._a).filter(i=>i[1]!==null&&typeof i[1]!="undefined").map(([i,s])=>i==="data-skruv-key"?[i,s]:[i,x(s,t,!1)]).filter(i=>i[1]!==null&&typeof i[1]!="undefined"));return{p:g,...t,a:n,c:T(t._c,t)}},A=(t,n,i,s)=>{var j;if(t.p!==g)throw new Error("unkown type in render: "+JSON.stringify(t));for(let e of t.c)if(e.p!==g)throw new Error("unkown type in render: "+JSON.stringify(e));if(!i||n&&!i.contains(n))return!1;let d=n.ownerDocument,l=d.documentElement;for(let e of n.getAttributeNames().filter(o=>!Object.keys(t.a).includes(o)))n.removeAttribute(e);for(let[e,o]of Object.entries(t.a))if(e!=="data-skruv-key"){if(e.slice(0,2)==="on"){let c=E.get(n),f=c==null?void 0:c[e],y=e.slice(2);if(c||(c={},E.set(n,c)),o instanceof Function){f&&f.toString()!==o.toString()&&(n.removeEventListener(y,f),c[e]=null),f||(c[e]=o,n.addEventListener(y,o));continue}f&&!o&&(n.removeEventListener(y,f),c[e]=null)}if(o===null||o===!1){n.getAttribute(e)&&n.removeAttribute(e);continue}n.setAttribute(e,o.toString()),e==="value"&&(typeof o=="number"||typeof o=="string")&&n instanceof HTMLInputElement&&(n[e]=o.toString()),(typeof o=="boolean"&&(n instanceof HTMLInputElement&&e==="checked"||n instanceof HTMLOptionElement&&e==="selected")||typeof o=="object")&&(n[e]=o)}if(t.r.r=()=>A(b(t),n,i,s),t.a["data-skruv-opaque"])return!0;let r=Array.from(n.childNodes),a=t.c,p=[],_=(e,o)=>e.nodeName.toLowerCase()===o.t&&!p.includes(e);for(let e=0;e<a.length;e++){let o=a[e],c=o.a["data-skruv-key"]?S.get(o.a["data-skruv-key"]):r.find(f=>_(f,o));c?p[e]=c:p[e]=null}let C=r.filter(e=>!p.includes(e));if(t.c.length||!t.a["data-skruv-wait-for-not-empty"])for(let e of C.filter(o=>!!o))n.removeChild(e),setTimeout(()=>{var o;!(l!=null&&l.contains(e))&&((o=E.get(e))==null?void 0:o.onremove)&&e.dispatchEvent(new CustomEvent("remove"))},1);for(let e=0;e<p.length;e++){let o=t.c[e],c=!1;if(p[e]){if(p[e]!==n.childNodes[e]){let y=p[e];y&&(e===0?n.prepend(y):n.childNodes[e-1].after(y))}}else{let y;t.t==="#comment"?y=d.createComment(""):o.t==="#text"?y=d.createTextNode(""):o.p===g&&(s||o.t==="svg")?y=d.createElementNS("http://www.w3.org/2000/svg",o.t):y=d.createElement(o.t),c=!0,n.childNodes[e]?n.replaceChild(y,n.childNodes[e]):e===0?n.prepend(y):n.childNodes[e-1].after(y)}let f=n.childNodes[e];if(f instanceof Text||f instanceof Comment){f.data!==o.a.data&&(f.data=o.a.data.toString());continue}if(!(f instanceof HTMLElement||f instanceof SVGElement))throw new Error("Child node of unknown type: "+JSON.stringify({childNode:f,child:o}));o.a["data-skruv-key"]&&!S.has(o.a["data-skruv-key"])&&S.set(o.a["data-skruv-key"],f),A(o,f,n,s||t.t==="svg"),c&&((j=E.get(f))==null?void 0:j.oncreate)&&f.dispatchEvent(new CustomEvent("create"))}return!0},G=async(t,n=document.documentElement,i=n==null?void 0:n.parentNode,s=!1)=>{if(!i)throw new Error("Skruv: No parent to render to");if(!(i instanceof HTMLElement||i instanceof SVGElement||i instanceof Document||i instanceof Window))throw new Error("Skruv: Parent of wrong type");m&&(b(t).r.r(),await M),A(b(t),n,i,s)},F={},H=new Proxy(F,{get:(t,n)=>(...i)=>O(n,...i)});export{I as Vnode,P as VnodeAtrributes,O as h,H as htmlFactory,G as render};
//# sourceMappingURL=index.min.js.map
