var j=Symbol.for("skruvDom"),O=Symbol.for("skruvDomPrepared"),g=new WeakMap,E=new WeakMap,P=new WeakMap,G=()=>{},U=new Promise(t=>{G=()=>t()}),_=new Set,S=(globalThis==null?void 0:globalThis.SkruvWaitForAsync)||!!document.querySelector("data-skruv-ssr-rendered");var H=(t,...e)=>{var r,l,i,o,f;return{s:j,t,...typeof e[0]=="object"&&!Array.isArray(e[0])&&!(e[0]instanceof Function)&&!(e[0]instanceof Function&&((i=(l=(r=e[0])==null?void 0:r.prototype)==null?void 0:l.toString)==null?void 0:i.call(l))==="[object AsyncGenerator]")&&!((o=e[0])!=null&&o[Symbol.asyncIterator])&&((f=e[0])==null?void 0:f.s)!==j?{_a:e[0],_c:e.slice(1)}:{_a:{},_c:e},r:{r:()=>(S&&!_.size&&(S=!1,G()),!0)}}},M=(t,e,r)=>{var i,o;let l=(f,a)=>{var d;return S&&((d=a==null?void 0:a._a)==null?void 0:d["data-skruv-finished"])!==!1&&(_.delete(f),a&&((a==null?void 0:a.s)===j?x(a):M(a,e,r))),g.set(f,a),e.r.r()};if(g.has(t))return g.get(t);if(typeof t=="object"&&(t==null?void 0:t[Symbol.asyncIterator])){let f=t;return S&&_.add(f),g.set(f,null),(async()=>{for await(let a of f)if(!l(t,a))break})(),!1}else{if(t instanceof Function&&((o=(i=t==null?void 0:t.prototype)==null?void 0:i.toString)==null?void 0:o.call(i))==="[object AsyncGenerator]")return S&&_.add(t),g.set(t,null),(async()=>{for await(let f of t())if(!l(t,f))break})(),!1;if(typeof t=="object"&&t!==null&&(t==null?void 0:t.then)instanceof Function){let f=t;return S&&_.add(t),g.set(f,null),(async()=>l(f,await f))(),!1}else{if(typeof t=="function"&&t.constructor.name==="AsyncFunction")return S&&_.add(t),g.set(t,null),(async()=>l(t,await t()))(),!1;if(typeof t=="function")return r?t():t;if(typeof t=="string"||typeof t=="number")return r?H("#text",{data:t.toString()}):t.toString();if(typeof t=="boolean")return t}}throw new Error("Unkown type in syncify: "+JSON.stringify(t))},I=(t,e)=>{let r=t.flat(1/0).map(l=>(l==null?void 0:l.s)===j?x(l):M(l,e,!0)).flat(1/0).filter(l=>l!==null&&typeof l!="boolean"&&typeof l!="undefined");return r.find(l=>(l==null?void 0:l.p)!==O)!==void 0?I(r,e):r},x=t=>{let e=Object.fromEntries(Object.entries(t._a).filter(r=>r[1]!==null&&typeof r[1]!="undefined").map(([r,l])=>r==="data-skruv-key"?[r,l]:[r,M(l,t,!1)]).filter(r=>r[1]!==null&&typeof r[1]!="undefined"));return{p:O,...t,a:e,c:I(t._c,t)}},C=(t,e,r,l)=>{var w;if(t.p!==O)throw new Error("unkown type in render: "+JSON.stringify(t));for(let s of t.c)if(s.p!==O)throw new Error("unkown type in render: "+JSON.stringify(s));if(!r||e&&!r.contains(e))return!1;let i=e.ownerDocument,o=i.documentElement;for(let s of e.getAttributeNames().filter(c=>!Object.keys(t.a).includes(c)))e.removeAttribute(s);for(let[s,c]of Object.entries(t.a))if(s!=="data-skruv-key"){if(s.slice(0,2)==="on"){let p=E.get(e),n=p==null?void 0:p[s],m=s.slice(2);if(p||(p={},E.set(e,p)),c instanceof Function){n&&n.toString()!==c.toString()&&(e.removeEventListener(m,n),p[s]=null),n||(p[s]=c,e.addEventListener(m,c));continue}n&&!c&&(e.removeEventListener(m,n),p[s]=null)}if(c===null||c===!1){e.getAttribute(s)&&e.removeAttribute(s);continue}e.setAttribute(s,c.toString()),s==="value"&&(typeof c=="number"||typeof c=="string")&&e instanceof HTMLInputElement&&(e[s]=c.toString()),(typeof c=="boolean"&&(e instanceof HTMLInputElement&&s==="checked"||e instanceof HTMLOptionElement&&s==="selected")||typeof c=="object")&&(e[s]=c)}if(t.r.r=()=>C(x(t),e,r,l),t.a["data-skruv-opaque"])return!0;let f=Array.from(e.childNodes),a=t.c,d=[],y=(s,c)=>s.nodeName.toLowerCase()===c.t&&!d.includes(s);for(let s=0;s<a.length;s++){let c=a[s],p=c.a["data-skruv-key"]?P.get(c.a["data-skruv-key"]):f.find(n=>y(n,c));p?d[s]=p:d[s]=null}let u=f.filter(s=>!d.includes(s));if(t.c.length||!t.a["data-skruv-wait-for-not-empty"])for(let s of u.filter(c=>!!c))e.removeChild(s),setTimeout(()=>{var c;!(o!=null&&o.contains(s))&&((c=E.get(s))==null?void 0:c.onremove)&&s.dispatchEvent(new CustomEvent("remove"))},1);for(let s=0;s<d.length;s++){let c=t.c[s],p=!1;if(d[s]){if(d[s]!==e.childNodes[s]){let m=d[s];m&&(s===0?e.prepend(m):e.childNodes[s-1].after(m))}}else{let m;t.t==="#comment"?m=i.createComment(""):c.t==="#text"?m=i.createTextNode(""):c.p===O&&(l||c.t==="svg")?m=i.createElementNS("http://www.w3.org/2000/svg",c.t):m=i.createElement(c.t),p=!0,e.childNodes[s]?e.replaceChild(m,e.childNodes[s]):s===0?e.prepend(m):e.childNodes[s-1].after(m)}let n=e.childNodes[s];if(n instanceof Text||n instanceof Comment){n.data!==c.a.data&&(n.data=c.a.data.toString());continue}if(!(n instanceof HTMLElement||n instanceof SVGElement))throw new Error("Child node of unknown type: "+JSON.stringify({childNode:n,child:c}));c.a["data-skruv-key"]&&!P.has(c.a["data-skruv-key"])&&P.set(c.a["data-skruv-key"],n),C(c,n,e,l||t.t==="svg"),p&&((w=E.get(n))==null?void 0:w.oncreate)&&n.dispatchEvent(new CustomEvent("create"))}return!0},J=async(t,e=document.documentElement,r=e==null?void 0:e.parentNode,l=!1)=>{if(!r)throw new Error("Skruv: No parent to render to");if(!(r instanceof HTMLElement||r instanceof SVGElement||r instanceof Document||r instanceof Window))throw new Error("Skruv: Parent of wrong type");S&&(x(t).r.r(),await U),C(x(t),e,r,l)},z={},W=new Proxy(z,{get:(t,e)=>(...r)=>H(e,...r)});var R=()=>{},D=new Promise(t=>{R=t}),T=new Map,B=t=>{let e=0;if(t.length===0)return e.toString();for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e.toString()},V=(t,...e)=>{var p;let r=t.reduce((n,m,h)=>{var b;return n.push(m),n.push(((b=e==null?void 0:e[h])==null?void 0:b.toString())||""),n},[]).join(""),l=/^\[.*?(?:(["'])(?:.|\\\1)*\1.*)*\]/,i=/([([,]|:scope\b)/,o=/^:scope\b/;function f(n,m){let h=n.search(i);if(h===-1)return{selector:`${m} ${n}`,rest:""};if(n[h]===",")return{selector:`${m} ${n.substring(0,h)}`,rest:n.substring(h+1)};let b=!0,$=!1;h=n.search(/\S/);let k=0;t:for(;h<n.length;++h){let F=n[h];switch(F){case"[":{let L=l.exec(n.substring(h));h+=(L?L[0].length:1)-1;continue}case"(":++k;continue;case":":if(b)if(o.test(n.substring(h))){if(k)return null}else continue;else continue;n=n.substring(0,h)+m+n.substring(h+6),h+=m.length,$=!0,--h;continue;case")":k&&--k;continue}if(!k)switch(F){case",":break t;case" ":case">":case"~":case"+":if(!b)continue;b=!1}}return{selector:($?"":`${m} `)+n.substring(0,h),rest:n.substring(h+1)}}function a(n,m){let h=[];for(;n;){let b=f(n,m);if(b===null)return":not(*)";h.push(b.selector),n=b.rest}return h.join(", ")}function d(n,m){if(n instanceof CSSMediaRule){let h=n.cssRules.length;for(let b=0;b<h;++b)d(n.cssRules[b],m);return}n instanceof CSSStyleRule&&(n.selectorText=a(n.selectorText,m))}let y=B(r),u=`skruv-css-scope-${y}`,w=`.${u}`;if(T.has(y))return u;let s;if(!(globalThis!=null&&globalThis.CSSOM)&&!((p=globalThis.document)!=null&&p.implementation))throw new Error("No css parser available. Either add CSSOM to globalThis or run in browser.");if(globalThis!=null&&globalThis.CSSOM)s=CSSOM.parse(r);else{let n=globalThis.document.implementation.createHTMLDocument(""),m=n.createElement("style");m.innerText=r,n.body.append(m),s=m.sheet,n.body.removeChild(m)}Array.from((s==null?void 0:s.cssRules)||[]).forEach(n=>d(n,w));let c=Array.from((s==null?void 0:s.cssRules)||[]).map(n=>n.cssText||"").join("");return T.set(y,c),R(),u};async function*q(){for(yield Array.from(T.values()).join("");;)await D,yield Array.from(T.values()).join(""),D=new Promise(t=>{R=t})}var K=(globalThis==null?void 0:globalThis.requestAnimationFrame)||(t=>setTimeout(t,0)),v=t=>{let e=class{constructor(i){this.name=i,this._scheduled=!1,this._skruv_promise=new Promise(o=>{this._skruv_resolve=o})}_resolve(){this._skruv_parent&&this._skruv_parent._resolve&&this._skruv_parent._resolve(),!this._scheduled&&(this._scheduled=!0,K(()=>{this._skruv_resolve(),this._skruv_promise=new Promise(i=>{this._skruv_resolve=i}),this._scheduled=!1}))}set(i,o,f){return o==="_skruv_parent"?(this._skruv_parent=f,!0):(i[o]!==f&&(i[o]=this.recurse(o,f,i)),!0)}get(i,o,f){return o==="getGenerator"?a=>({key:[a,i],[Symbol.asyncIterator]:()=>{let d=!1;return{next:async()=>(d?await this._skruv_promise:d=!0,{done:!1,value:f[a]})}}}):o==="skruv_resolve"?()=>this._resolve():o==="toJSON"?i.constructor===Object?Object.getOwnPropertyNames(i).reduce((a,d)=>{var y;return a[d]=((y=i[d])==null?void 0:y.toJSON)||i[d],a},{}):i.constructor===Array?i.map(a=>(a==null?void 0:a.toJSON)||a):i:o===Symbol.asyncIterator?()=>{let a=!1;return{next:async()=>(a?await this._skruv_promise:a=!0,{done:!1,value:f})}}:i[o]}deleteProperty(i,o){let f=delete i[o];return this._resolve(),f}recurse(i,o,f){var a;if(o&&o.constructor)if(o.constructor===Object&&((a=f==null?void 0:f[i])==null?void 0:a.constructor)===Object){for(let d of Object.getOwnPropertyNames(o))f[i][d]!==o[d]&&(f[i][d]=o[d]);for(let d of Object.getOwnPropertyNames(f[i]).filter(y=>!Object.getOwnPropertyNames(o).includes(y)))delete f[i][d],this._resolve();return f[i]}else if(o.constructor===Object){let d=new this.constructor(`${this.name}.${i}`);o=Object.keys(o).reduce((y,u)=>(y[u]=this.recurse(`${i}.${u}`,o[u]),typeof y[u]=="object"&&y[u]!==null&&(y[u]._skruv_parent=d),y),{}),o=new Proxy(o,d),o._skruv_parent=this,this._resolve()}else if(o.constructor===Array){let d=new this.constructor(`${this.name}.${i}`);o=o.map((y,u)=>{let w=this.recurse(`${i}[${u}]`,y);return typeof w=="object"&&w!==null&&(w._skruv_parent=d),w}),o=new Proxy(o,d),o._skruv_parent=this,this._resolve()}else this._resolve();else this._resolve();return o}},r=new Proxy(t.constructor===Array?[]:{},new e("root"));return Object.assign(r,t),r};var{html:Q,head:X,title:Y,script:Z,meta:N,body:tt,main:et,h1:st,form:nt,input:ot,button:rt,ol:it,li:ct,a:ft,style:lt}=W,A=v({todos:["Write todos"]}),at=V`:scope{color:#f1f1f1;background:#0f0f0f}body{max-width:40ch;margin:0 auto}form{display:flex}input{flex:1}a{color:#9b9b9b}`,dt=()=>J(Q({lang:"en-US",class:at},X(Y(A.todos.getGenerator(0)),N({name:"viewport",content:"width=device-width, initial-scale=1"}),lt(q)),tt(et(st(A.todos.getGenerator(0)),nt({onsubmit:t=>{t.preventDefault(),A.todos.unshift(new FormData(t.target).get("todo")),t.target.reset()}},ot({type:"text",name:"todo"}),rt("New!")),async function*(){for await(let t of A)yield it(t.todos.map((e,r)=>ct(`${e} `,ft({href:"#",onclick:l=>{l.preventDefault(),t.todos.splice(r,1)}},"x"))))}),!!globalThis.skruvSSRScript&&Z({type:"module"},globalThis.skruvSSRScript))));dt();export{dt as doRender};
//# sourceMappingURL=index.min.js.map
