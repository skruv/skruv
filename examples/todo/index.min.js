var P=Symbol.for("skruvDom"),E=Symbol.for("skruvDomPrepared"),S=new WeakMap,T=new WeakMap,$=new WeakMap,J=()=>{},v=new Promise(t=>{J=()=>t()}),x=new Set,_=(globalThis==null?void 0:globalThis.SkruvWaitForAsync)||!!document.querySelector("data-skruv-ssr-rendered");var A=(t,...e)=>{var i,r,o,c,l;return{s:P,t,...typeof e[0]=="object"&&!Array.isArray(e[0])&&!(e[0]instanceof Function)&&!(e[0]instanceof Function&&((o=(r=(i=e[0])==null?void 0:i.prototype)==null?void 0:r.toString)==null?void 0:o.call(r))==="[object AsyncGenerator]")&&!((c=e[0])!=null&&c[Symbol.asyncIterator])&&((l=e[0])==null?void 0:l.s)!==P?{_a:e[0],_c:e.slice(1)}:{_a:{},_c:e},r:{r:()=>(_&&!x.size&&(_=!1,J()),!0)}}},L=(t,e,i)=>{var o,c;let r=(l,a)=>{var m;return _&&((m=a==null?void 0:a._a)==null?void 0:m["data-skruv-finished"])!==!1&&(x.delete(l),a&&((a==null?void 0:a.s)===P?j(a):L(a,e,i))),S.set(l,a),e.r.r()};if(S.has(t))return S.get(t);if(typeof t=="object"&&(t==null?void 0:t[Symbol.asyncIterator])){let l=t;return _&&x.add(l),S.set(l,null),(async()=>{for await(let a of l)if(!r(t,a))break})(),!1}else{if(t instanceof Function&&((c=(o=t==null?void 0:t.prototype)==null?void 0:o.toString)==null?void 0:c.call(o))==="[object AsyncGenerator]")return _&&x.add(t),S.set(t,null),(async()=>{for await(let l of t())if(!r(t,l))break})(),!1;if(typeof t=="object"&&t!==null&&(t==null?void 0:t.then)instanceof Function){let l=t;return _&&x.add(t),S.set(l,null),(async()=>r(l,await l))(),!1}else{if(typeof t=="function"&&t.constructor.name==="AsyncFunction")return _&&x.add(t),S.set(t,null),(async()=>r(t,await t()))(),!1;if(typeof t=="function")return i?t():t;if(typeof t=="string"||typeof t=="number")return i?A("#text",{data:t.toString()}):t.toString();if(typeof t=="boolean")return t}}throw new Error("Unkown type in syncify: "+JSON.stringify(t))},W=(t,e)=>{let i=t.flat(1/0).map(r=>(r==null?void 0:r.s)===P?j(r):L(r,e,!0)).flat(1/0).filter(r=>r!==null&&typeof r!="boolean"&&typeof r!="undefined");return i.find(r=>(r==null?void 0:r.p)!==E)!==void 0?W(i,e):i},j=t=>{let e=Object.fromEntries(Object.entries(t._a).filter(i=>i[1]!==null&&typeof i[1]!="undefined").map(([i,r])=>i==="data-skruv-key"?[i,r]:[i,L(r,t,!1)]).filter(i=>i[1]!==null&&typeof i[1]!="undefined"));return{p:E,...t,a:e,c:W(t._c,t)}},R=(t,e,i,r)=>{var g;if(t.p!==E)throw new Error("unkown type in render: "+JSON.stringify(t));for(let n of t.c)if(n.p!==E)throw new Error("unkown type in render: "+JSON.stringify(n));if(!i||e&&!i.contains(e))return!1;let o=e.ownerDocument,c=o.documentElement;for(let n of e.getAttributeNames().filter(f=>!Object.keys(t.a).includes(f)))e.removeAttribute(n);for(let[n,f]of Object.entries(t.a))if(n!=="data-skruv-key"){if(n.slice(0,2)==="on"){let p=T.get(e),s=p==null?void 0:p[n],d=n.slice(2);if(p||(p={},T.set(e,p)),f instanceof Function){s&&s.toString()!==f.toString()&&(e.removeEventListener(d,s),p[n]=null),s||(p[n]=f,e.addEventListener(d,f));continue}s&&!f&&(e.removeEventListener(d,s),p[n]=null)}if(f===null||f===!1){e.getAttribute(n)&&e.removeAttribute(n);continue}e.setAttribute(n,f.toString()),n==="value"&&(typeof f=="number"||typeof f=="string")&&e instanceof HTMLInputElement&&(e[n]=f.toString()),(typeof f=="boolean"&&(e instanceof HTMLInputElement&&n==="checked"||e instanceof HTMLOptionElement&&n==="selected")||typeof f=="object")&&(e[n]=f)}if(t.r.r=()=>R(j(t),e,i,r),t.a["data-skruv-opaque"])return!0;let l=Array.from(e.childNodes),a=t.c,m=[],y=(n,f)=>n.nodeName.toLowerCase()===f.t&&!m.includes(n);for(let n=0;n<a.length;n++){let f=a[n],p=f.a["data-skruv-key"]?$.get(f.a["data-skruv-key"]):l.find(s=>y(s,f));p?m[n]=p:m[n]=null}let u=l.filter(n=>!m.includes(n));if(t.c.length||!t.a["data-skruv-wait-for-not-empty"])for(let n of u.filter(f=>!!f))e.removeChild(n),setTimeout(()=>{var f;!(c!=null&&c.contains(n))&&((f=T.get(n))==null?void 0:f.onremove)&&n.dispatchEvent(new CustomEvent("remove"))},1);for(let n=0;n<m.length;n++){let f=t.c[n],p=!1;if(m[n]){if(m[n]!==e.childNodes[n]){let d=m[n];d&&(n===0?e.prepend(d):e.childNodes[n-1].after(d))}}else{let d;t.t==="#comment"?d=o.createComment(""):f.t==="#text"?d=o.createTextNode(""):f.p===E&&(r||f.t==="svg")?d=o.createElementNS("http://www.w3.org/2000/svg",f.t):d=o.createElement(f.t),p=!0,e.childNodes[n]?e.replaceChild(d,e.childNodes[n]):n===0?e.prepend(d):e.childNodes[n-1].after(d)}let s=e.childNodes[n];if(s instanceof Text||s instanceof Comment){s.data!==f.a.data&&(s.data=f.a.data.toString());continue}if(!(s instanceof HTMLElement||s instanceof SVGElement))throw new Error("Child node of unknown type: "+JSON.stringify({childNode:s,child:f}));f.a["data-skruv-key"]&&!$.has(f.a["data-skruv-key"])&&$.set(f.a["data-skruv-key"],s),R(f,s,e,r||t.t==="svg"),p&&((g=T.get(s))==null?void 0:g.oncreate)&&s.dispatchEvent(new CustomEvent("create"))}return!0},D=async(t,e=document.documentElement,i=e==null?void 0:e.parentNode,r=!1)=>{if(!i)throw new Error("Skruv: No parent to render to");if(!(i instanceof HTMLElement||i instanceof SVGElement||i instanceof Document||i instanceof Window))throw new Error("Skruv: Parent of wrong type");_&&(j(t).r.r(),await v),R(j(t),e,i,r)},K={},tt=new Proxy(K,{get:(t,e)=>(...i)=>A(e,...i)});var F=()=>{},V=new Promise(t=>{F=t}),C=new Map,Q=t=>{let e=0;if(t.length===0)return e.toString();for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e.toString()},q=(t,...e)=>{var p;let i=t.reduce((s,d,h)=>{var b;return s.push(d),s.push(((b=e==null?void 0:e[h])==null?void 0:b.toString())||""),s},[]).join(""),r=/^\[.*?(?:(["'])(?:.|\\\1)*\1.*)*\]/,o=/([([,]|:scope\b)/,c=/^:scope\b/;function l(s,d){let h=s.search(o);if(h===-1)return{selector:`${d} ${s}`,rest:""};if(s[h]===",")return{selector:`${d} ${s.substring(0,h)}`,rest:s.substring(h+1)};let b=!0,G=!1;h=s.search(/\S/);let O=0;t:for(;h<s.length;++h){let H=s[h];switch(H){case"[":{let I=r.exec(s.substring(h));h+=(I?I[0].length:1)-1;continue}case"(":++O;continue;case":":if(b)if(c.test(s.substring(h))){if(O)return null}else continue;else continue;s=s.substring(0,h)+d+s.substring(h+6),h+=d.length,G=!0,--h;continue;case")":O&&--O;continue}if(!O)switch(H){case",":break t;case" ":case">":case"~":case"+":if(!b)continue;b=!1}}return{selector:(G?"":`${d} `)+s.substring(0,h),rest:s.substring(h+1)}}function a(s,d){let h=[];for(;s;){let b=l(s,d);if(b===null)return":not(*)";h.push(b.selector),s=b.rest}return h.join(", ")}function m(s,d){if(s instanceof CSSMediaRule){let h=s.cssRules.length;for(let b=0;b<h;++b)m(s.cssRules[b],d);return}s instanceof CSSStyleRule&&(s.selectorText=a(s.selectorText,d))}let y=Q(i),u=`skruv-css-scope-${y}`,g=`.${u}`;if(C.has(y))return u;let n;if(!(globalThis!=null&&globalThis.CSSOM)&&!((p=globalThis.document)!=null&&p.implementation))throw new Error("No css parser available. Either add CSSOM to globalThis or run in browser.");if(globalThis!=null&&globalThis.CSSOM)n=CSSOM.parse(i);else{let s=globalThis.document.implementation.createHTMLDocument(""),d=s.createElement("style");d.innerText=i,s.body.append(d),n=d.sheet,s.body.removeChild(d)}Array.from((n==null?void 0:n.cssRules)||[]).forEach(s=>m(s,g));let f=Array.from((n==null?void 0:n.cssRules)||[]).map(s=>s.cssText||"").join("");return C.set(y,f),F(),u};async function*z(){for(yield Array.from(C.values()).join("");;)await V,yield Array.from(C.values()).join(""),V=new Promise(t=>{F=t})}var X=(globalThis==null?void 0:globalThis.requestAnimationFrame)||(t=>setTimeout(t,0)),U=t=>{let e=class{constructor(o){this.name=o,this._scheduled=!1,this._skruv_promise=new Promise(c=>{this._skruv_resolve=c})}_resolve(){this._skruv_parent&&this._skruv_parent._resolve&&this._skruv_parent._resolve(),!this._scheduled&&(this._scheduled=!0,X(()=>{this._skruv_resolve(),this._skruv_promise=new Promise(o=>{this._skruv_resolve=o}),this._scheduled=!1}))}set(o,c,l){return c==="_skruv_parent"?(this._skruv_parent=l,!0):(o[c]!==l&&(o[c]=this.recurse(c,l,o)),!0)}get(o,c,l){return c==="getGenerator"?a=>({key:[a,o],[Symbol.asyncIterator]:()=>{let m=!1;return{next:async()=>(m?await this._skruv_promise:m=!0,{done:!1,value:l[a]})}}}):c==="skruv_resolve"?()=>this._resolve():c==="toJSON"?o.constructor===Object?Object.getOwnPropertyNames(o).reduce((a,m)=>{var y;return a[m]=((y=o[m])==null?void 0:y.toJSON)||o[m],a},{}):o.constructor===Array?o.map(a=>(a==null?void 0:a.toJSON)||a):o:c===Symbol.asyncIterator?()=>{let a=!1;return{next:async()=>(a?await this._skruv_promise:a=!0,{done:!1,value:l})}}:o[c]}deleteProperty(o,c){let l=delete o[c];return this._resolve(),l}recurse(o,c,l){var a;if(c&&c.constructor)if(c.constructor===Object&&((a=l==null?void 0:l[o])==null?void 0:a.constructor)===Object){for(let m of Object.getOwnPropertyNames(c))l[o][m]!==c[m]&&(l[o][m]=c[m]);for(let m of Object.getOwnPropertyNames(l[o]).filter(y=>!Object.getOwnPropertyNames(c).includes(y)))delete l[o][m],this._resolve();return l[o]}else if(c.constructor===Object){let m=new this.constructor(`${this.name}.${o}`);c=Object.keys(c).reduce((y,u)=>(y[u]=this.recurse(`${o}.${u}`,c[u]),typeof y[u]=="object"&&y[u]!==null&&(y[u]._skruv_parent=m),y),{}),c=new Proxy(c,m),c._skruv_parent=this,this._resolve()}else if(c.constructor===Array){let m=new this.constructor(`${this.name}.${o}`);c=c.map((y,u)=>{let g=this.recurse(`${o}[${u}]`,y);return typeof g=="object"&&g!==null&&(g._skruv_parent=m),g}),c=new Proxy(c,m),c._skruv_parent=this,this._resolve()}else this._resolve();else this._resolve();return c}},i=new Proxy(t.constructor===Array?[]:{},new e("root"));return Object.assign(i,t),i};var Z=t=>t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,(e,i)=>(i?"-":"")+e.toLowerCase()),B="#fragment",w=(t,e={})=>k(t,e),k=(t,e={})=>{if(t===B&&e.children)return e.children;if(t===B)return[];let{children:i,...r}=e;return Object.keys(r).filter(o=>o!==Z(o)).forEach(o=>{r[Z(o)]=r[o],delete r[o]}),r["class-name"]&&(r.class=r["class-name"],delete r["class-name"]),r["html-for"]&&(r.for=r["html-for"],delete r["html-for"]),i?A(t,r||{},i):A(t,r||{})};var M=U({todos:["Write todos"]}),Y=q`:scope{color:#f1f1f1;background:#0f0f0f}body{max-width:40ch;margin:0 auto}form{display:flex}input{flex:1}a{color:#9b9b9b}`;D(k("html",{lang:"en-US",class:Y,children:[k("head",{children:[w("title",{children:M.todos.getGenerator(0)}),w("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),w("style",{children:z})]}),w("body",{children:k("main",{children:[w("h1",{children:M.todos.getGenerator(0)}),k("form",{onsubmit:t=>{t.preventDefault(),M.todos.unshift(new FormData(t.target).get("todo")),t.target.reset()},children:[w("input",{name:"todo"}),w("button",{children:"New!"})]}),w("ol",{children:async function*(){for await(let t of M.todos)yield t.map((e,i)=>k("li",{children:[e," ",w("a",{href:"#",onclick:r=>{r.preventDefault(),t.splice(i,1)},children:"x"})]}))}})]})})]}));
//# sourceMappingURL=index.min.js.map
