{
  "version": 3,
  "sources": ["index.js"],
  "sourcesContent": ["const s = Symbol.for('skruvDom')\nconst eventPrefix = 'data-event-'\n/**\n * @typedef {Vnode|Vnode[]|String|Boolean|Number} SkruvChildNode\n * @typedef {SkruvChildNode[]} SkruvChildNodes\n */\n/**\n * @typedef {object} Vnode\n * @prop {Symbol} s\n * @prop {String} t\n * @prop {SkruvChildNodes} c\n * @prop {Record<string,(string|boolean|Function|number|Object)> & {_r:{_r:() => boolean}?}} a\n * @prop {{_r:() => boolean}} [_r]\n */\n/** @type {Vnode} */\nexport const Vnode = { s, t: '', c: [], a: { _r: { _r: () => false } } }\n/**\n * @param {string} t\n * @param  {(Record<string, any>|Vnode)[]} c\n * @returns {Vnode}\n */\n// @ts-ignore: TODO: The check for non-attribute objects does not satisfy TS\nexport const h = (t, ...c) => ({\n  s,\n  t: t.toUpperCase(),\n  ...(\n    // @ts-ignore: its exactly because we don't know if its there that we check it\n    !(c[0]?.[Symbol.asyncIterator]) &&\n        c[0]?.constructor === Object &&\n      c[0]?.s !== s\n      ? {\n        a: c[0],\n        c: c.slice(1)\n      }\n      : {\n        a: {},\n        c: c\n      }\n  )\n})\n\n/** @type {WeakMap<Vnode, Node>} */\nconst keyed = new WeakMap()\n/** @type {Record<string, Node>} */\nconst domCache = {}\n/**\n * @param {Vnode} current\n * @param {Node} _currentNode\n * @param {ParentNode?} parentNode\n * @param {*} isSvg\n * @returns {boolean}\n */\nexport const render = (\n  current,\n  _currentNode = globalThis.document.documentElement,\n  parentNode = _currentNode.parentNode,\n  isSvg = false,\n  doc = (parentNode?.ownerDocument || _currentNode?.ownerDocument)\n) => {\n  let currentNode = _currentNode\n  /** @type {ChildNode[]|NodeList} */\n  let childNodes = []\n  if (!parentNode || !doc || (currentNode && !parentNode.contains(currentNode))) { return false }\n  if (typeof current === 'boolean' || current === null || current === undefined) {\n    if (currentNode) { parentNode.removeChild(currentNode) }\n    return true\n  }\n  if (\n    !currentNode ||\n    (\n      ((typeof current === 'string' || typeof current === 'number') && currentNode?.nodeName !== '#text') ||\n      (current?.t && currentNode?.nodeName !== current?.t) ||\n      // @ts-ignore: TODO: Handle key storage better\n      (currentNode?._skruvKey !== current?.a?._key)\n    )\n  ) {\n    if (typeof current === 'string' || typeof current === 'number') {\n      currentNode = (domCache.text || (domCache.text = doc.createTextNode(''))).cloneNode()\n    } else if (isSvg || current.t === 'svg') {\n      currentNode = (domCache[current.t] || (domCache[current.t] = doc.createElementNS('http://www.w3.org/2000/svg', current.t))).cloneNode()\n    } else {\n      currentNode = (domCache[current.t] || (domCache[current.t] = doc.createElement(current.t))).cloneNode()\n    }\n    if (_currentNode) {\n      parentNode.replaceChild(currentNode, _currentNode)\n    } else {\n      parentNode.appendChild(currentNode)\n    }\n    // @ts-ignore: see above\n    if (current?.a?._key) { currentNode._skruvKey = current?.a?._key }\n    // @ts-ignore: oncreate should always be callable. TODO: add strict typing\n    if (current?.a?.oncreate) { current?.a?.oncreate(currentNode) }\n  } else {\n    childNodes = currentNode.childNodes\n  }\n  if ((typeof current === 'string' || typeof current === 'number')) {\n    // @ts-ignore: We already checked this above. It's not 'never'\n    if (('' + currentNode.data) !== ('' + current)) { currentNode.data = current }\n    return true\n  }\n  if (current._r) { current._r._r = () => render(current, currentNode, parentNode, isSvg) }\n  for (const key in current.a) {\n    if (key[0] === '_') { continue }\n    if (key[0] === 'o' && key[1] === 'n') {\n      // @ts-ignore: TODO: this is a hacky way to store what the last eventlistener was\n      if (!currentNode[eventPrefix + key] || ('' + currentNode[eventPrefix + key]) !== ('' + current.a[key])) {\n        // @ts-ignore: See above\n        if (currentNode[eventPrefix + key]) { currentNode.removeEventListener(key.slice(2), currentNode[eventPrefix + key]) }\n        // @ts-ignore: See above\n        currentNode.addEventListener(key.slice(2), current.a[key])\n        // @ts-ignore: See above\n        currentNode[eventPrefix + key] = current.a[key]\n      } else if (!current.a[key]) {\n        // @ts-ignore: data-event-* is the old function\n        currentNode.removeEventListener(key.slice(2), currentNode[eventPrefix + key])\n      }\n    // @ts-ignore: If this was a text or comment element we would have returned above\n    } else if (current.a[key] !== currentNode.getAttribute(key)) {\n      if (\n        (\n          typeof current.a[key] === 'boolean' &&\n          (\n            (current.t === 'INPUT' && key === 'checked') ||\n            (current.t === 'OPTION' && key === 'selected')\n          )\n        ) || typeof current.a[key] === 'object' // Support complex data passing for custom elements\n      ) {\n        // @ts-ignore TS does not think HTML properties are accessible directly?\n        currentNode[key] = current.a[key]\n      }\n      if (current.a[key]) {\n        // @ts-ignore: If this was a text or comment element we would have returned above\n        currentNode.setAttribute(key, '' + current.a[key])\n      } else {\n        // @ts-ignore: If this was a text or comment element we would have returned above\n        currentNode.removeAttribute(key)\n      }\n    }\n  }\n  const children = current.c.flat(Infinity)\n  if (!children.length && childNodes.length) {\n    if (current.a['data-skruv-wait-for-not-empty']) {\n      return true\n    }\n    // @ts-ignore: If this was a text or comment element we would have returned above\n    currentNode.replaceChildren()\n    return true\n  }\n  if (childNodes.length > children.length) {\n    for (let i = children.length; i < childNodes.length; i++) {\n      currentNode.removeChild(childNodes[i])\n    }\n  }\n  for (let i = 0; i < children.length; i++) {\n    // @ts-ignore: TODO: the flattening seems to confuse TS\n    if (keyed.has(children[i])) {\n      // @ts-ignore: See above\n      const keyedNode = keyed.get(children[i])\n      if (keyedNode && keyedNode !== childNodes[i]) {\n        if (keyedNode === childNodes[i + 1]) {\n          currentNode.removeChild(childNodes[i])\n        // @ts-ignore: See above\n        } else if (keyed.has(children[i + 1]) && keyed.get(children[i + 1]) === childNodes[i]) {\n          currentNode.insertBefore(keyedNode, childNodes[i])\n        } else if (childNodes[i]) {\n          currentNode.replaceChild(keyedNode, childNodes[i])\n        } else {\n          currentNode.appendChild(keyedNode)\n        }\n        // @ts-ignore: See above\n        keyed.set(children[i], childNodes[i])\n      }\n      continue\n    }\n    // @ts-ignore: See above\n    render(children[i], childNodes[i] || false, currentNode, isSvg)\n  }\n  keyed.set(current, currentNode)\n  return true\n}\n\nexport const elementFactory = new Proxy({}, {\n  /** @type {(_: any, name: string) => (arg0: (Record<string, any>|Vnode)[]) => Vnode} */\n  get: (_, name) => (...c) => h(name, ...c)\n})\n"],
  "mappings": "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",
  "names": ["s", "eventPrefix", "Vnode", "h", "t", "c", "_a", "_b", "_c", "keyed", "domCache", "render", "current", "_currentNode", "parentNode", "isSvg", "doc", "_d", "_e", "currentNode", "childNodes", "key", "children", "keyedNode", "elementFactory", "_", "name"]
}
